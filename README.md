# LonelyPlanets
AMUSE scripts for integrating planetary systems in a stellar cluster
Written by Simon Portegies Zwart (Leiden, 2023)

LonelyPlanets is based on AMUSE, which can be downloaded from github at:
https://github.com/amusecode/amuse

The idea of LonelyPlanets is based on the manuscript Cai, M.X.,
Portegies Zwart, S.F., Kouwenhoven, M.B., Spurzem, R., 2019, MNRAS
489, 4311 (2019MNRAS.489.4311C), On the survivability of planets in
young massive clusters and its implication of planet orbital
architectures in globular clusters.

Here we present an independent implementation which works on any
N-body integrators and stellar evolution code in AMUSE, and the effect
of the Galactic tidal field is included.

The LonelyPlanets script can be used in conjunction with any of the
N-body codes and stellar evolution codes implemented in AMUSE, it
includes stellar evolution, collisions, and a semi-analytic Galactic
potential.

For installation instructions, read the file INSTALL

For the license, read the file LICENSE

Running LonelyPlanets is done in two steps.

Make a production-run environment.

# Generate Initial conditions:
Initial conditions can be generated by any AMUSE script.  The simplest
would be to generate them from a simple cluster model.
Make a directory for the initial conditions
  %> mkdir ICs
  %> python ./make_cluster_of_stars.py --nstars 1000 --radius 1 
  %> python ./name_stars.py -f plummer.amuse --name Sun --nstars 1 -F cl_pl_N1000_Rv1pc.amuse

for more complex initial condition generators we refer to the special
AMUSE package for generating initial conditions, which can be found on
github at:
https://github.com/amusecode/initial-conditions-generator

for convenience, the files generated by these functions are already provided in the directory: ICs.
We provide an additional file, called
cl_TorchMWB_N690_Rv025pc.amuse
which contains the initial conditions for the simulations presented in
the Methods section of the manuscript.  This latter cluster is
somewhat challenging to run, as it contains 6890 stars in a tight
non-virial cluster.



Now you have the initial conditions it is time to run stage 1, as follows

# Stage 1:
In your production environment, generate the stage 1 directory
  %> mkdir S1

You can only run with an initial amuse file containing the cluster.
Input file: <input snapshot amuse file>
for example: ../ICs/cl_pl_N1000_Rv1pc.amuse
Log output filename: <log-outputfilename>
for example: cluster_S1.log

Run the code via
  %> python <LonelyPlanets source directory>run_LonelyPlanets_S1.py -f cl_pl_N1000_Rv1pc.amuse  --Nnn 6 -t 1000 >& <log-outputfilename>

runs the script with 6 nearest neighbors for 1000Myr

The script produces a number of files, including the following:
cluster_i000000.amuse
cluster_i000001.amuse
...
cluster_i001000.amuse

the little plotting routine called
 %> ../src/plot_cluster.py -f cluster_i000042.amuse
can be used to plot the cluster 

and at least one lonely-planet stellar key file, of the form:
lps_key_11250059647118512025.amuse
Here the key (in this case the identifier 11250059647118512025) identifies the star in the cluster_i....amuse files.
This file contains the encounter evolution of the 6 nearest neighbors for this particular star.
This file is used in stage 2 to re-evolve star (in this case with
identifier 11250059647118512025) but in stage 2 including planets and
asteroids.

Note that if you run the other initial conditions (cl_TorchMWB_N690_Rv025pc.amuse) the first star has identifier 11112349482046263321, and the stellar encounter files are named: lps_key_11112349482046263321.amuse



Now you have the entire encounter sequence for your stars, it is time to run stage 2, as follows

# Stage 2:
In your production environment, generate the stage 2 directory
  %> mkdir S2

and run the script
  %> python <LonelyPlanets source directory>run_LonelyPlanets_S2.py --Nast 1000 -t 1000 -f <input S1 file>& <log-outputfilename>

You can only run after Stage 1, and with the star that was followed
identified. This file is located in your S1 directory.  The 
star-file can be the following:
../S1/lps_key_11250059647118512025.amuse
Here 11250059647118512025 is the key that identifies the star in Stage 1.

Input file: <input S1 file>
for example: ../S1/lps_key_11250059647118512025.amuse
Log output filename: <log-outputfilename>
for example: cluster_S2_key_11250059647118512025.log

# Processing Data
Data for a specific star (identified by its key) is store three files:
lp_planets_key_<key>.amuse
and 
lp_escapers_key_<key>.amuse
Here <key> identifies the star, as before.

In our example these will be the following files:
lp_planets_key_11250059647118512025.amuse
and 
lp_escapers_key_11250059647118512025.amuse

The file: lp_planets_key_<key>.amuse contains snapshots of the
planetary system at the designated output diagnostic times.

The file: lp_escapers_key_<key>.amuse contains individual objects at
the moment they escaped and left the system (in this example case the
planetesimals or planets the got unbound from the parent star <key>).

These data may be further analyzed.
